<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Flashcard Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Lexend', sans-serif;
            background-color: #f0f4f8;
            user-select: none;
            touch-action: manipulation;
        }

        .flashcard {
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 2px solid #e2e8f0;
        }

        .option-btn {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .option-btn:active {
            transform: scale(0.95);
        }

        .correct {
            background-color: #4ade80 !important;
            border-color: #22c55e !important;
            color: white !important;
        }

        .wrong {
            background-color: #f87171 !important;
            border-color: #ef4444 !important;
            color: white !important;
            animation: shake 0.4s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .progress-bar {
            transition: width 0.5s ease-in-out;
        }

        .emoji-large {
            font-size: 3rem;
            display: block;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Top Bar -->
    <div class="w-full max-w-md flex justify-between items-center mb-4 px-2">
        <button id="mute-btn" class="p-2 bg-white rounded-full shadow-sm hover:bg-slate-50 transition-colors" title="Toggle Sound">
            <span id="mute-icon" class="text-xl">üîä</span>
        </button>
        <div class="text-right">
            <span class="text-slate-600 font-bold block" id="score-display">Mastery: 0/100</span>
            <span class="text-slate-400 text-xs" id="remaining-text">Queued: 100</span>
        </div>
    </div>

    <!-- Progress -->
    <div class="w-full max-w-md mb-6">
        <div class="w-full bg-slate-200 rounded-full h-3">
            <div id="progress-fill" class="bg-green-500 h-3 rounded-full progress-bar" style="width: 0%"></div>
        </div>
    </div>

    <!-- Game Area -->
    <main id="game-container" class="w-full max-w-md bg-white rounded-3xl p-6 flashcard relative overflow-hidden">
        <div id="card-content">
            <h2 id="question-text" class="text-xl md:text-2xl font-bold text-center mb-8 text-slate-800">
                Loading...
            </h2>

            <div id="options-grid" class="grid grid-cols-2 gap-4">
                <!-- Options injected here -->
            </div>
        </div>

        <!-- Feedback Overlay -->
        <div id="feedback" class="hidden absolute inset-0 flex items-center justify-center bg-white/95 z-10">
            <div class="text-center p-6">
                <div id="feedback-icon" class="text-7xl mb-4">‚úÖ</div>
                <div id="feedback-text" class="text-2xl font-bold mb-2">Great Job!</div>
                <div id="feedback-subtext" class="text-slate-500 font-medium"></div>
            </div>
        </div>
    </main>

    <!-- Footer Controls -->
    <div class="mt-8 flex gap-4 flex-wrap justify-center">
        <button id="reset-btn" class="px-6 py-2 bg-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-300 transition-colors">
            Restart
        </button>
        <button onclick="document.getElementById('file-input').click()" class="px-6 py-2 bg-blue-100 text-blue-700 rounded-xl font-bold hover:bg-blue-200 transition-colors flex items-center gap-2">
            <span>üìÇ</span> Import .txt
        </button>
        <input type="file" id="file-input" hidden accept=".txt" onchange="handleFileUpload(this)">
    </div>

    <script>
        // --- SOUND ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let isMuted = false;

        function playSound(type) {
            if (isMuted) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); 
                osc.frequency.exponentialRampToValueAtTime(1046.50, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0.2, audioCtx.currentTime + 0.05);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'wrong') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(220, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(110, audioCtx.currentTime + 0.2);
                gain.gain.setValueAtTime(0, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0.2, audioCtx.currentTime + 0.05);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            }
        }

        // --- DATA ---
        // 100 Unique Questions
        let initialQuestions = [
            // OCCUPATIONS
            { q: "Who flies an airplane?", options: [{t:"Pilot", e:"üë®‚Äç‚úàÔ∏è"}, {t:"Actor", e:"üé≠"}, {t:"Teacher", e:"üë©‚Äçüè´"}, {t:"Postman", e:"üìÆ"}], correct: 0 },
            { q: "Who helps you when you are sick?", options: [{t:"Doctor", e:"üë®‚Äç‚öïÔ∏è"}, {t:"Chef", e:"üë®‚Äçüç≥"}, {t:"Fireman", e:"üë®‚Äçüöí"}, {t:"Farmer", e:"üë®‚Äçüåæ"}], correct: 0 },
            { q: "Who cooks food in a restaurant?", options: [{t:"Chef", e:"üë®‚Äçüç≥"}, {t:"Pilot", e:"üë®‚Äç‚úàÔ∏è"}, {t:"Nurse", e:"üë©‚Äç‚öïÔ∏è"}, {t:"Driver", e:"üöå"}], correct: 0 },
            { q: "Who puts out fires?", options: [{t:"Firefighter", e:"üë®‚Äçüöí"}, {t:"Baker", e:"üçû"}, {t:"Artist", e:"üé®"}, {t:"Vet", e:"üê∂"}], correct: 0 },
            { q: "Who teaches students?", options: [{t:"Teacher", e:"üë©‚Äçüè´"}, {t:"Clown", e:"ü§°"}, {t:"Police", e:"üëÆ"}, {t:"Dentist", e:"ü¶∑"}], correct: 0 },
            { q: "Who grows vegetables?", options: [{t:"Farmer", e:"üë®‚Äçüåæ"}, {t:"Singer", e:"üé§"}, {t:"Astronaut", e:"üë©‚ÄçüöÄ"}, {t:"Judge", e:"‚öñÔ∏è"}], correct: 0 },
            { q: "Who catches bad guys?", options: [{t:"Police", e:"üëÆ"}, {t:"Doctor", e:"üë®‚Äç‚öïÔ∏è"}, {t:"Painter", e:"üñåÔ∏è"}, {t:"Waiter", e:"üçΩÔ∏è"}], correct: 0 },
            { q: "Who fixes cars?", options: [{t:"Mechanic", e:"üîß"}, {t:"Teacher", e:"üë©‚Äçüè´"}, {t:"Writer", e:"üìù"}, {t:"Dancer", e:"üíÉ"}], correct: 0 },
            { q: "Who travels to space?", options: [{t:"Astronaut", e:"üë©‚ÄçüöÄ"}, {t:"Driver", e:"üöó"}, {t:"Farmer", e:"üåæ"}, {t:"Baker", e:"ü•ñ"}], correct: 0 },
            { q: "Who paints pictures?", options: [{t:"Artist", e:"üé®"}, {t:"Soldier", e:"üíÇ"}, {t:"Nurse", e:"üè•"}, {t:"Pilot", e:"‚úàÔ∏è"}], correct: 0 },
            
            // FOOD
            { q: "What might you drink when thirsty?", options: [{t:"Juice", e:"üçπ"}, {t:"Bread", e:"üçû"}, {t:"Apple", e:"üçé"}, {t:"Rice", e:"üçö"}], correct: 0 },
            { q: "Which is a fruit?", options: [{t:"Banana", e:"üçå"}, {t:"Potato", e:"ü•î"}, {t:"Carrot", e:"ü•ï"}, {t:"Onion", e:"üßÖ"}], correct: 0 },
            { q: "What do bees make?", options: [{t:"Honey", e:"üçØ"}, {t:"Milk", e:"ü•õ"}, {t:"Water", e:"üíß"}, {t:"Soup", e:"üç≤"}], correct: 0 },
            { q: "Which food is yellow?", options: [{t:"Corn", e:"üåΩ"}, {t:"Blueberry", e:"ü´ê"}, {t:"Tomato", e:"üçÖ"}, {t:"Spinach", e:"üçÉ"}], correct: 0 },
            { q: "What is made from milk?", options: [{t:"Cheese", e:"üßÄ"}, {t:"Jam", e:"üçì"}, {t:"Ham", e:"üçñ"}, {t:"Rice", e:"üçö"}], correct: 0 },
            { q: "Which is a vegetable?", options: [{t:"Broccoli", e:"ü•¶"}, {t:"Apple", e:"üçé"}, {t:"Grape", e:"üçá"}, {t:"Cherry", e:"üçí"}], correct: 0 },
            { q: "What do we eat for breakfast?", options: [{t:"Cereal", e:"ü•£"}, {t:"Steak", e:"ü•©"}, {t:"Candy", e:"üç¨"}, {t:"Soda", e:"ü•§"}], correct: 0 },
            { q: "Which fruit is red?", options: [{t:"Strawberry", e:"üçì"}, {t:"Lemon", e:"üçã"}, {t:"Lime", e:"üçà"}, {t:"Banana", e:"üçå"}], correct: 0 },
            { q: "What is sweet?", options: [{t:"Cake", e:"üç∞"}, {t:"Lemon", e:"üçã"}, {t:"Salt", e:"üßÇ"}, {t:"Pepper", e:"üå∂Ô∏è"}], correct: 0 },
            { q: "What comes from a chicken?", options: [{t:"Egg", e:"ü•ö"}, {t:"Milk", e:"ü•õ"}, {t:"Wool", e:"üß∂"}, {t:"Honey", e:"üçØ"}], correct: 0 },

            // ANIMALS
            { q: "Which animal says 'Meow'?", options: [{t:"Cat", e:"üê±"}, {t:"Dog", e:"üê∂"}, {t:"Cow", e:"üêÆ"}, {t:"Pig", e:"üê∑"}], correct: 0 },
            { q: "Which animal gives us milk?", options: [{t:"Cow", e:"üêÆ"}, {t:"Lion", e:"ü¶Å"}, {t:"Tiger", e:"üêØ"}, {t:"Monkey", e:"üêí"}], correct: 0 },
            { q: "Which animal has a long neck?", options: [{t:"Giraffe", e:"ü¶í"}, {t:"Bear", e:"üêª"}, {t:"Ant", e:"üêú"}, {t:"Frog", e:"üê∏"}], correct: 0 },
            { q: "Which animal lives in water?", options: [{t:"Fish", e:"üêü"}, {t:"Bird", e:"üê¶"}, {t:"Cat", e:"üê±"}, {t:"Rabbit", e:"üê∞"}], correct: 0 },
            { q: "Which animal can fly?", options: [{t:"Bird", e:"üê¶"}, {t:"Elephant", e:"üêò"}, {t:"Dog", e:"üê∂"}, {t:"Snake", e:"üêç"}], correct: 0 },
            { q: "Which animal is very big?", options: [{t:"Elephant", e:"üêò"}, {t:"Mouse", e:"üê≠"}, {t:"Bee", e:"üêù"}, {t:"Ant", e:"üêú"}], correct: 0 },
            { q: "Which animal has a trunk?", options: [{t:"Elephant", e:"üêò"}, {t:"Lion", e:"ü¶Å"}, {t:"Zebra", e:"ü¶ì"}, {t:"Horse", e:"üê¥"}], correct: 0 },
            { q: "Which animal is the King of the Jungle?", options: [{t:"Lion", e:"ü¶Å"}, {t:"Sheep", e:"üêë"}, {t:"Rabbit", e:"üê∞"}, {t:"Duck", e:"ü¶Ü"}], correct: 0 },
            { q: "Which animal hops?", options: [{t:"Rabbit", e:"üê∞"}, {t:"Turtle", e:"üê¢"}, {t:"Snail", e:"üêå"}, {t:"Fish", e:"üêü"}], correct: 0 },
            { q: "Which animal gives us wool?", options: [{t:"Sheep", e:"üêë"}, {t:"Pig", e:"üê∑"}, {t:"Chicken", e:"üêî"}, {t:"Horse", e:"üê¥"}], correct: 0 },

            // COLORS
            { q: "What color is an orange?", options: [{t:"Orange", e:"üüß"}, {t:"Pink", e:"üü™"}, {t:"Blue", e:"üü¶"}, {t:"Brown", e:"üü´"}], correct: 0 },
            { q: "What color is the grass?", options: [{t:"Green", e:"üü©"}, {t:"Red", e:"üü•"}, {t:"Yellow", e:"üü®"}, {t:"Purple", e:"üü™"}], correct: 0 },
            { q: "What color is the sky?", options: [{t:"Blue", e:"üü¶"}, {t:"Green", e:"üü©"}, {t:"Red", e:"üü•"}, {t:"Orange", e:"üüß"}], correct: 0 },
            { q: "What color is a banana?", options: [{t:"Yellow", e:"üü®"}, {t:"Blue", e:"üü¶"}, {t:"Purple", e:"üü™"}, {t:"Pink", e:"üß†"}], correct: 0 },
            { q: "What color is snow?", options: [{t:"White", e:"‚¨ú"}, {t:"Black", e:"‚¨õ"}, {t:"Green", e:"üü©"}, {t:"Red", e:"üü•"}], correct: 0 },
            { q: "What color is the night sky?", options: [{t:"Black", e:"‚¨õ"}, {t:"Yellow", e:"üü®"}, {t:"White", e:"‚¨ú"}, {t:"Orange", e:"üüß"}], correct: 0 },
            { q: "What color is a flamingo?", options: [{t:"Pink", e:"ü¶©"}, {t:"Green", e:"üü©"}, {t:"Blue", e:"üü¶"}, {t:"Black", e:"‚¨õ"}], correct: 0 },
            { q: "What color is chocolate?", options: [{t:"Brown", e:"üç´"}, {t:"Blue", e:"üü¶"}, {t:"Pink", e:"üß†"}, {t:"Green", e:"üü©"}], correct: 0 },
            { q: "What color is a tomato?", options: [{t:"Red", e:"üü•"}, {t:"Blue", e:"üü¶"}, {t:"Purple", e:"üü™"}, {t:"White", e:"‚¨ú"}], correct: 0 },
            { q: "What color is an eggplant?", options: [{t:"Purple", e:"üçÜ"}, {t:"Red", e:"üü•"}, {t:"Yellow", e:"üü®"}, {t:"Orange", e:"üüß"}], correct: 0 },

            // TOOLS & OBJECTS
            { q: "What tool do you use to cut paper?", options: [{t:"Scissors", e:"‚úÇÔ∏è"}, {t:"Glue", e:"üß™"}, {t:"Pen", e:"üñãÔ∏è"}, {t:"Notebook", e:"üìí"}], correct: 0 },
            { q: "What do you use to write?", options: [{t:"Pencil", e:"‚úèÔ∏è"}, {t:"Hammer", e:"üî®"}, {t:"Spoon", e:"ü•Ñ"}, {t:"Brush", e:"üñåÔ∏è"}], correct: 0 },
            { q: "What tells us the time?", options: [{t:"Clock", e:"‚è∞"}, {t:"Lamp", e:"üí°"}, {t:"Table", e:"ü™ë"}, {t:"Book", e:"üìö"}], correct: 0 },
            { q: "What do you use to call someone?", options: [{t:"Phone", e:"üì±"}, {t:"Remote", e:"üì∫"}, {t:"Calculator", e:"üßÆ"}, {t:"Camera", e:"üì∑"}], correct: 0 },
            { q: "What do you use to sweep the floor?", options: [{t:"Broom", e:"üßπ"}, {t:"Shovel", e:"‚õèÔ∏è"}, {t:"Rake", e:"üçÇ"}, {t:"Fork", e:"üç¥"}], correct: 0 },
            { q: "What do you use to unlock a door?", options: [{t:"Key", e:"üîë"}, {t:"Coin", e:"ü™ô"}, {t:"Ring", e:"üíç"}, {t:"Pen", e:"üñäÔ∏è"}], correct: 0 },
            { q: "What do you use to eat soup?", options: [{t:"Spoon", e:"ü•Ñ"}, {t:"Fork", e:"üç¥"}, {t:"Knife", e:"üî™"}, {t:"Straw", e:"ü•§"}], correct: 0 },
            { q: "What do you use to drink water?", options: [{t:"Cup", e:"ü•õ"}, {t:"Plate", e:"üçΩÔ∏è"}, {t:"Bowl", e:"ü•£"}, {t:"Pan", e:"üç≥"}], correct: 0 },
            { q: "What do you sleep on?", options: [{t:"Bed", e:"üõèÔ∏è"}, {t:"Desk", e:"üñ•Ô∏è"}, {t:"Chair", e:"ü™ë"}, {t:"Bike", e:"üö≤"}], correct: 0 },
            { q: "What do you use to brush teeth?", options: [{t:"Toothbrush", e:"ü™•"}, {t:"Comb", e:"ü™Æ"}, {t:"Soap", e:"üßº"}, {t:"Sponge", e:"üßΩ"}], correct: 0 },

            // NATURE & SEASONS
            { q: "During which season do leaves fall?", options: [{t:"Autumn", e:"üçÇ"}, {t:"Summer", e:"‚òÄÔ∏è"}, {t:"Winter", e:"‚òÉÔ∏è"}, {t:"Spring", e:"üå∏"}], correct: 0 },
            { q: "Where do fish live?", options: [{t:"Water", e:"üåä"}, {t:"Trees", e:"üå≥"}, {t:"Cloud", e:"‚òÅÔ∏è"}, {t:"Sand", e:"üèúÔ∏è"}], correct: 0 },
            { q: "What shines in the day?", options: [{t:"Sun", e:"‚òÄÔ∏è"}, {t:"Moon", e:"üåô"}, {t:"Star", e:"‚≠ê"}, {t:"Lamp", e:"üí°"}], correct: 0 },
            { q: "What falls from the sky?", options: [{t:"Rain", e:"üåßÔ∏è"}, {t:"Rock", e:"ü™®"}, {t:"Grass", e:"üå±"}, {t:"Sand", e:"üèñÔ∏è"}], correct: 0 },
            { q: "What is cold and white?", options: [{t:"Snow", e:"‚ùÑÔ∏è"}, {t:"Fire", e:"üî•"}, {t:"Dirt", e:"üí©"}, {t:"Sand", e:"üèúÔ∏è"}], correct: 0 },
            { q: "Where do birds live?", options: [{t:"Nest", e:"ü™π"}, {t:"Cave", e:"üï≥Ô∏è"}, {t:"Water", e:"üíß"}, {t:"Car", e:"üöó"}], correct: 0 },
            { q: "What grows on trees?", options: [{t:"Leaves", e:"üçÉ"}, {t:"Rocks", e:"ü™®"}, {t:"Cars", e:"üöó"}, {t:"Shoes", e:"üëü"}], correct: 0 },
            { q: "When do we see stars?", options: [{t:"Night", e:"üåÉ"}, {t:"Morning", e:"üåÖ"}, {t:"Noon", e:"üïõ"}, {t:"Afternoon", e:"üïë"}], correct: 0 },
            { q: "What is a mountain?", options: [{t:"High", e:"üèîÔ∏è"}, {t:"Flat", e:"üõ£Ô∏è"}, {t:"Liquid", e:"üíß"}, {t:"Small", e:"üêú"}], correct: 0 },
            { q: "Where do we plant flowers?", options: [{t:"Garden", e:"üåª"}, {t:"Kitchen", e:"üç≥"}, {t:"Bedroom", e:"üõèÔ∏è"}, {t:"Bathroom", e:"üõÅ"}], correct: 0 },

            // VEHICLES
            { q: "Which vehicle has two wheels?", options: [{t:"Bicycle", e:"üö≤"}, {t:"Car", e:"üöó"}, {t:"Bus", e:"üöå"}, {t:"Train", e:"üöÇ"}], correct: 0 },
            { q: "What goes on water?", options: [{t:"Boat", e:"üö§"}, {t:"Car", e:"üöó"}, {t:"Truck", e:"üöõ"}, {t:"Train", e:"üöÇ"}], correct: 0 },
            { q: "What flies in the air?", options: [{t:"Plane", e:"‚úàÔ∏è"}, {t:"Bus", e:"üöå"}, {t:"Bike", e:"üö≤"}, {t:"Ship", e:"üö¢"}], correct: 0 },
            { q: "What runs on tracks?", options: [{t:"Train", e:"üöÇ"}, {t:"Car", e:"üöó"}, {t:"Boat", e:"üö§"}, {t:"Bus", e:"üöå"}], correct: 0 },
            { q: "What has 4 wheels?", options: [{t:"Car", e:"üöó"}, {t:"Bike", e:"üö≤"}, {t:"Boat", e:"üö§"}, {t:"Plane", e:"‚úàÔ∏è"}], correct: 0 },
            { q: "Who drives a school bus?", options: [{t:"Driver", e:"üëÆ"}, {t:"Pilot", e:"‚úàÔ∏è"}, {t:"Chef", e:"üë®‚Äçüç≥"}, {t:"Doctor", e:"üë®‚Äç‚öïÔ∏è"}], correct: 0 },
            { q: "What do we use to transport sick people?", options: [{t:"Ambulance", e:"üöë"}, {t:"Taxi", e:"üöï"}, {t:"Police Car", e:"üöì"}, {t:"Truck", e:"üöõ"}], correct: 0 },
            { q: "What vehicle is very long?", options: [{t:"Train", e:"üöÜ"}, {t:"Bike", e:"üö≤"}, {t:"Scooter", e:"üõ¥"}, {t:"Skateboard", e:"üõπ"}], correct: 0 },
            { q: "What has a siren?", options: [{t:"Police Car", e:"üöì"}, {t:"Bicycle", e:"üö≤"}, {t:"Scooter", e:"üõ¥"}, {t:"Skateboard", e:"üõπ"}], correct: 0 },
            { q: "What do you use to move furniture?", options: [{t:"Truck", e:"üöö"}, {t:"Car", e:"üöó"}, {t:"Bike", e:"üö≤"}, {t:"Scooter", e:"üõ¥"}], correct: 0 },

            // BODY PARTS
            { q: "What do we use to see?", options: [{t:"Eyes", e:"üëÄ"}, {t:"Ears", e:"üëÇ"}, {t:"Nose", e:"üëÉ"}, {t:"Hands", e:"‚úã"}], correct: 0 },
            { q: "What do we use to hear?", options: [{t:"Ears", e:"üëÇ"}, {t:"Eyes", e:"üëÄ"}, {t:"Mouth", e:"üëÑ"}, {t:"Feet", e:"ü¶∂"}], correct: 0 },
            { q: "What do we use to smell?", options: [{t:"Nose", e:"üëÉ"}, {t:"Hand", e:"‚úã"}, {t:"Eye", e:"üëÅÔ∏è"}, {t:"Knee", e:"ü¶µ"}], correct: 0 },
            { q: "What do we use to walk?", options: [{t:"Legs", e:"ü¶µ"}, {t:"Hands", e:"‚úã"}, {t:"Ears", e:"üëÇ"}, {t:"Nose", e:"üëÉ"}], correct: 0 },
            { q: "What do we use to hold things?", options: [{t:"Hands", e:"‚úã"}, {t:"Feet", e:"ü¶∂"}, {t:"Eyes", e:"üëÄ"}, {t:"Ears", e:"üëÇ"}], correct: 0 },
            { q: "What is inside your mouth?", options: [{t:"Tongue", e:"üëÖ"}, {t:"Nose", e:"üëÉ"}, {t:"Ear", e:"üëÇ"}, {t:"Eye", e:"üëÅÔ∏è"}], correct: 0 },
            { q: "What is on your head?", options: [{t:"Hair", e:"üíá"}, {t:"Hand", e:"‚úã"}, {t:"Foot", e:"ü¶∂"}, {t:"Knee", e:"ü¶µ"}], correct: 0 },
            { q: "What connects your hand to your arm?", options: [{t:"Wrist", e:"üí™"}, {t:"Knee", e:"ü¶µ"}, {t:"Ankle", e:"ü¶∂"}, {t:"Neck", e:"üë§"}], correct: 0 },
            { q: "How many fingers do you have on one hand?", options: [{t:"5", e:"üñêÔ∏è"}, {t:"2", e:"‚úåÔ∏è"}, {t:"10", e:"üëê"}, {t:"1", e:"‚òùÔ∏è"}], correct: 0 },
            { q: "What beats in your chest?", options: [{t:"Heart", e:"‚ù§Ô∏è"}, {t:"Brain", e:"üß†"}, {t:"Stomach", e:"ü•™"}, {t:"Foot", e:"ü¶∂"}], correct: 0 },

            // CLOTHING
            { q: "What do you wear on your feet?", options: [{t:"Shoes", e:"üëü"}, {t:"Hat", e:"üé©"}, {t:"Gloves", e:"üß§"}, {t:"Shirt", e:"üëï"}], correct: 0 },
            { q: "What do you wear on your head?", options: [{t:"Hat", e:"üß¢"}, {t:"Sock", e:"üß¶"}, {t:"Shoe", e:"üëû"}, {t:"Belt", e:"üëñ"}], correct: 0 },
            { q: "What do you wear when it's cold?", options: [{t:"Coat", e:"üß•"}, {t:"T-shirt", e:"üëï"}, {t:"Shorts", e:"ü©≥"}, {t:"Sandals", e:"ü©¥"}], correct: 0 },
            { q: "What do you wear on your hands?", options: [{t:"Gloves", e:"üß§"}, {t:"Hat", e:"üß¢"}, {t:"Socks", e:"üß¶"}, {t:"Shoes", e:"üëü"}], correct: 0 },
            { q: "What do you wear to swim?", options: [{t:"Swimsuit", e:"ü©±"}, {t:"Coat", e:"üß•"}, {t:"Jeans", e:"üëñ"}, {t:"Scarf", e:"üß£"}], correct: 0 },
            { q: "What do you wear around your neck?", options: [{t:"Scarf", e:"üß£"}, {t:"Belt", e:"üëñ"}, {t:"Sock", e:"üß¶"}, {t:"Shoe", e:"üëü"}], correct: 0 },
            { q: "What do you wear on your legs?", options: [{t:"Pants", e:"üëñ"}, {t:"Hat", e:"üß¢"}, {t:"Shirt", e:"üëï"}, {t:"Glove", e:"üß§"}], correct: 0 },
            { q: "What keeps your feet warm?", options: [{t:"Socks", e:"üß¶"}, {t:"Hat", e:"üß¢"}, {t:"Belt", e:"üëñ"}, {t:"Gloves", e:"üß§"}], correct: 0 },
            { q: "What do you wear to bed?", options: [{t:"Pajamas", e:"üò¥"}, {t:"Jeans", e:"üëñ"}, {t:"Coat", e:"üß•"}, {t:"Shoes", e:"üëü"}], correct: 0 },
            { q: "What protects your eyes from sun?", options: [{t:"Sunglasses", e:"üï∂Ô∏è"}, {t:"Hat", e:"üß¢"}, {t:"Scarf", e:"üß£"}, {t:"Mask", e:"üò∑"}], correct: 0 },

            // ACTIONS
            { q: "What does a fish do?", options: [{t:"Swim", e:"üèä"}, {t:"Fly", e:"üïäÔ∏è"}, {t:"Run", e:"üèÉ"}, {t:"Jump", e:"ü¶ò"}], correct: 0 },
            { q: "What does a bird do?", options: [{t:"Fly", e:"üïäÔ∏è"}, {t:"Swim", e:"üèä"}, {t:"Read", e:"üìñ"}, {t:"Drive", e:"üöó"}], correct: 0 },
            { q: "What do you do with a book?", options: [{t:"Read", e:"üìñ"}, {t:"Eat", e:"üçΩÔ∏è"}, {t:"Wear", e:"üëï"}, {t:"Drive", e:"üöó"}], correct: 0 },
            { q: "What do you do with a pen?", options: [{t:"Write", e:"‚úçÔ∏è"}, {t:"Eat", e:"üçΩÔ∏è"}, {t:"Sleep", e:"üò¥"}, {t:"Run", e:"üèÉ"}], correct: 0 },
            { q: "What do you do when you are tired?", options: [{t:"Sleep", e:"üò¥"}, {t:"Run", e:"üèÉ"}, {t:"Jump", e:"ü¶ò"}, {t:"Dance", e:"üíÉ"}], correct: 0 },
            { q: "What do you do when you are hungry?", options: [{t:"Eat", e:"üçΩÔ∏è"}, {t:"Sleep", e:"üò¥"}, {t:"Drink", e:"ü•§"}, {t:"Wash", e:"üöø"}], correct: 0 },
            { q: "What do you do with water?", options: [{t:"Drink", e:"ü•§"}, {t:"Eat", e:"üçΩÔ∏è"}, {t:"Read", e:"üìñ"}, {t:"Write", e:"‚úçÔ∏è"}], correct: 0 },
            { q: "What do you do in a race?", options: [{t:"Run", e:"üèÉ"}, {t:"Sleep", e:"üò¥"}, {t:"Eat", e:"üçΩÔ∏è"}, {t:"Sit", e:"ü™ë"}], correct: 0 },
            { q: "What do you do to music?", options: [{t:"Dance", e:"üíÉ"}, {t:"Sleep", e:"üò¥"}, {t:"Read", e:"üìñ"}, {t:"Cry", e:"üò¢"}], correct: 0 },
            { q: "What do you do with a ball?", options: [{t:"Throw", e:"‚öæ"}, {t:"Eat", e:"üçΩÔ∏è"}, {t:"Write", e:"‚úçÔ∏è"}, {t:"Read", e:"üìñ"}], correct: 0 }
        ].map((q, i) => ({...q, id: i + 1}));

        // --- GAME LOGIC ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        let questionQueue = [];
        let solvedIds = new Set();
        let totalUnique = 0;
        let canClick = true;

        const questionText = document.getElementById('question-text');
        const optionsGrid = document.getElementById('options-grid');
        const scoreDisplay = document.getElementById('score-display');
        const remainingText = document.getElementById('remaining-text');
        const progressFill = document.getElementById('progress-fill');
        const feedbackOverlay = document.getElementById('feedback');
        const feedbackIcon = document.getElementById('feedback-icon');
        const feedbackText = document.getElementById('feedback-text');
        const feedbackSubtext = document.getElementById('feedback-subtext');
        const resetBtn = document.getElementById('reset-btn');
        const muteBtn = document.getElementById('mute-btn');
        const muteIcon = document.getElementById('mute-icon');

        function initGame(questions) {
            totalUnique = questions.length;
            solvedIds.clear();
            questionQueue = shuffleArray([...questions]);
            updateProgress();
            loadNext();
        }

        function updateProgress() {
            const solvedCount = solvedIds.size;
            scoreDisplay.innerText = `Mastery: ${solvedCount}/${totalUnique}`;
            remainingText.innerText = `Queued: ${questionQueue.length}`;
            progressFill.style.width = totalUnique > 0 ? `${(solvedCount / totalUnique) * 100}%` : '0%';
        }

        function loadNext() {
            if (questionQueue.length === 0) {
                showFinalScreen();
                return;
            }

            canClick = true;
            const q = questionQueue[0];
            
            const words = q.q.split(' ');
            if (['Who', 'What', 'Where', 'Which', 'When', 'Why', 'How'].includes(words[0])) {
                words[0] = `<span class="text-red-500">${words[0]}</span>`;
            }
            questionText.innerHTML = words.join(' ');

            optionsGrid.innerHTML = '';
            
            // Randomize buttons for this question
            const shuffledOptions = shuffleArray([...q.options.map((o, idx) => ({...o, originalIndex: idx}))]);
            
            shuffledOptions.forEach((opt) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn bg-slate-50 border-2 border-slate-200 rounded-2xl p-4 flex flex-col items-center justify-center hover:border-blue-400 hover:bg-blue-50';
                
                // Fallback for missing emoji
                const displayEmoji = opt.e || 'üîπ';

                btn.innerHTML = `
                    <span class="emoji-large">${displayEmoji}</span>
                    <span class="text-sm font-bold text-slate-700 text-center">${opt.t}</span>
                `;
                btn.onclick = () => handleAnswer(opt.originalIndex, btn);
                optionsGrid.appendChild(btn);
            });
            updateProgress();
        }

        function handleAnswer(selectedIndex, btn) {
            if (!canClick) return;
            canClick = false;

            const currentQ = questionQueue[0];
            const isCorrect = selectedIndex === currentQ.correct;

            if (isCorrect) {
                playSound('correct');
                btn.classList.add('correct');
                solvedIds.add(currentQ.id);
                questionQueue.shift();
                showFeedback(true);
            } else {
                playSound('wrong');
                btn.classList.add('wrong');
                
                // Move missed question to the back
                const missed = questionQueue.shift();
                questionQueue.push(missed);
                showFeedback(false);
            }

            setTimeout(() => {
                feedbackOverlay.classList.add('hidden');
                loadNext();
            }, 1600);
        }

        function showFeedback(isCorrect) {
            feedbackIcon.innerText = isCorrect ? '‚úÖ' : 'üîÅ';
            feedbackText.innerText = isCorrect ? 'Great Job!' : 'Keep Practicing!';
            feedbackSubtext.innerText = isCorrect ? 'You mastered this one.' : 'This card is going back to the end of the stack.';
            feedbackOverlay.classList.remove('hidden');
        }

        function showFinalScreen() {
            const container = document.getElementById('game-container');
            container.innerHTML = `
                <div class="text-center py-10">
                    <div class="text-7xl mb-6">üèÜ</div>
                    <h2 class="text-3xl font-bold mb-4">Lesson Mastered!</h2>
                    <p class="text-xl text-slate-600 mb-8">You successfully finished all ${totalUnique} challenges.</p>
                    <button onclick="location.reload()" class="bg-green-500 text-white px-10 py-4 rounded-2xl font-bold text-xl hover:bg-green-600 transition-all shadow-lg hover:shadow-xl">
                        Play Again
                    </button>
                </div>
            `;
        }

        // --- IMPORT LOGIC ---
        function handleFileUpload(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const newQuestions = parseQuestions(text);
                if (newQuestions.length > 0) {
                    if(confirm(`Successfully loaded ${newQuestions.length} questions. Start game?`)) {
                        initGame(newQuestions);
                    }
                } else {
                    alert("No valid questions found. Please check file format: Question|Correct|Wrong1|Wrong2|Wrong3");
                }
            };
            reader.readAsText(file);
            input.value = ''; // Reset
        }

        function parseQuestions(text) {
            const lines = text.split('\n');
            const parsed = [];
            let idCounter = 1;

            for (let line of lines) {
                line = line.trim();
                if (!line || line.startsWith('#')) continue;

                const parts = line.split('|').map(p => p.trim());
                if (parts.length >= 5) {
                    // Format: Q | Correct | Wrong1 | Wrong2 | Wrong3
                    // We attempt to extract emoji from the string if present, otherwise just text
                    const extractEmoji = (str) => {
                        const emojiRegex = /(\p{Emoji_Presentation}|\p{Extended_Pictographic})/u;
                        const match = str.match(emojiRegex);
                        return match ? match[0] : null;
                    };

                    const cleanText = (str) => str.replace(/(\p{Emoji_Presentation}|\p{Extended_Pictographic})/u, '').trim();

                    const createOption = (rawStr) => {
                        const emo = extractEmoji(rawStr);
                        // If no emoji found in text, leave it null (will use fallback in display)
                        return {
                            t: rawStr, // Keep full text including emoji for simplicity or strip it
                            e: emo
                        };
                    };

                    parsed.push({
                        id: idCounter++,
                        q: parts[0],
                        options: [
                            createOption(parts[1]),
                            createOption(parts[2]),
                            createOption(parts[3]),
                            createOption(parts[4])
                        ],
                        correct: 0 // The first option in the text file is assumed correct
                    });
                }
            }
            return parsed;
        }

        muteBtn.onclick = () => {
            isMuted = !isMuted;
            muteIcon.innerText = isMuted ? 'üîá' : 'üîä';
        };

        resetBtn.onclick = () => {
            if(confirm("Restart the lesson?")) location.reload();
        };

        // Start
        initGame(initialQuestions);
    </script>
</body>
</html>
